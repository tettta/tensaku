# configs/config.yaml
# Main experiment config (Strict). Keep this file consistent: all defaults must exist.

defaults:
  - _self_
  - run: base
  - data: base
  - model: bert
  - train: standard
  - infer: base
  - al: base
  - confidence: default
  - gate: default
  - cleaner: base
  - viz: preset
  - task: standard_supervised
  - split: base
  - split/mode: n_train

hydra:
  run:
    # NOTE: use run.outputs_root (not project_root) to avoid missing-key issues.
    dir: ${run.outputs_root}/${data.qid}/${split.subdir}/${run.recipe}/${run.tag}/${al.sampler.name}/seed=${run.seed}
  sweep:
    dir: ${run.outputs_root}
    subdir: ${data.qid}/${split.subdir}/${run.recipe}/${run.tag}/${al.sampler.name}/seed=${run.seed}
  job:
    chdir: true
  # ログ設定（Hydra job_logging）
  # - main.log: 既存どおり（INFO以上）
  # - mem.log : メモリ監視用（tensaku.mem の DEBUG のみ）
  #   * rootへは流さない（データ本文などが混ざる事故を防ぐ）
  #   * ローテーションで肥大化を防ぐ
  job_logging:
    version: 1
    disable_existing_loggers: false
    formatters:
      simple:
        format: "[%(asctime)s][%(name)s][%(levelname)s] - %(message)s"
    handlers:
      console:
        class: logging.StreamHandler
        formatter: simple
        stream: ext://sys.stdout
      file:
        class: logging.FileHandler
        formatter: simple
        filename: main.log
        mode: a
        delay: true
      mem_file:
        class: logging.handlers.RotatingFileHandler
        formatter: simple
        filename: mem.log
        mode: a
        maxBytes: 5000000      # 5MB
        backupCount: 5         # 直近5世代だけ保持
        delay: true
    # mem専用ロガー：ここだけDEBUG。rootへは伝播させない。
    #loggers:
      #tensaku.mem:
        #level: DEBUG
        #handlers: [mem_file]
        #propagate: false
    root:
      level: INFO
      handlers: [console, file]
