run:
  experiment: "exp"
  name: "seed42"
  seed: 42
  out_dir: /home/esakit25/work/tensaku/outputs/Y14_1-2_1_3
  data_dir: /home/esakit25/work/tensaku/data_sas/splits/Y14_1-2_1_3

  on_exist: overwrite      # overwrite / skip / error の3種を想定

  save_logits: true
  save_predictiions: true

cleanup:
    immediate:
      checkpoints: true
      temp_data: true

    delayed:
      infer_arrays: true
      arrays: true

    post_experiment:
      all_checkpoints: false
      infer_arrays: true
      temp_dirs: true

data:
  # BaseDatasetAdapter / SasJsonlAdapter で使用
  input_all: /home/esakit25/work/tensaku/data_sas/all.jsonl
  qid: Y14_1-2_1_3
  files:
    labeled: labeled.jsonl
    dev: dev.jsonl
    test: test.jsonl
    pool: pool.jsonl
  text_key_primary: mecab
  label_key: score
  id_key: id
  max_len: 128

task:
  name: sas_total_score

split:
  label_key: score
  seed: 42
  stratify: true
  mode: n_train # n_train / ratio
  n_train: 50

  # 全体に対する比率（合計 ≒ 1.0）
  ratio:
    test:    0.15
    dev:     0.15
    #labeled: 0.2
    #pool:    0.5


model:
  name: cl-tohoku/bert-base-japanese-v3
  # head: clf  <- models.py では参照されていないため削除
  speed: full
  num_labels: 15
  ckpt: null

train:
  epochs: 20 # 今回の実験ではここが効いていたはずです
  batch_size: 16
  lr_full: 2.0e-05
  lr_frozen: 0.0005
  # early_stop_metric: "valid/loss" <- train.py は QWK ベースで best を保存するため削除
  patience: 3

infer:
  ckpt: null
  trust: false
  # device: auto (デフォルト値)

confidence:
  # CLI (tensaku confidence) 用の設定。ALループ内では infer.trust が優先されるが、
  # 将来 step_confidence で使うために残しても良い
  estimators:
    - name: msp
    - name: entropy
    #- name: energy
    - name: trust
      version: v2
      metric: cosine
      k_list: [5]
      agg: median
      trim_q: 0.1
      normalize: zscore

gate:
  # hitl.py で参照される設定
  conf_key: trust
  eps_cse: 0.05
  cse_abs_err: 2
  # eps_list, accept_policy は hitl.py ロジックにないため削除

# hitl: ... <- gate セクションと重複しており、hitl.py は gate を参照するため削除

al:
  rounds: 30          # ログに合わせて修正
  budget: 50
  # start_size: 50   <- split済みデータを読み込むため、ここでは制御しない（削除）
  seed: 42
  
  sampler:
    name: trust
    #name: hybrid
    sub_budget_ratio: 3.0   # 元の alpha
    k_cluster: 200                  # 元の k_center
    uncertainty_strategy: least_confidence

logging:
  level: INFO